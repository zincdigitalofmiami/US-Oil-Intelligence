
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin - Manage Integrations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css"/>
    <style>
        body { background-color: #070b14; color: #e5e7eb; }
        .card { background-color: #0b1120; border: 1px solid #374151; }
        .input { background-color: #1f2a37; border: 1px solid #4b5563; padding: 0.5rem; border-radius: 0.375rem; width: 100%; }
        .btn-primary { background-color: #2563eb; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 600; }
        .feedback { padding: 0.75rem; border-radius: 0.375rem; margin-top: 1rem; }
        .feedback.success { background-color: #166534; color: #d1fae5; }
        .feedback.error { background-color: #991b1b; color: #fee2e2; }
    </style>
</head>
<body class="p-8">

    <main class="max-w-xl mx-auto">
        <h1 class="text-2xl font-bold mb-4">Manage External Integrations</h1>
        
        <div class="card p-6 rounded-lg">
            <h2 class="text-xl font-semibold mb-3">ProFarmer Credentials</h2>
            <p class="text-gray-400 text-sm mb-4">
                These credentials are used for the automated web scraper to fetch market analysis.
                They are stored securely in Google Secret Manager.
            </p>

            <form id="profarmer-form">
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium text-gray-300 mb-1">Username</label>
                    <input type="text" id="username" name="username" class="input" required>
                </div>

                <div class="mb-4">
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-1">Password</label>
                    <input type="password" id="password" name="password" class="input" required>
                </div>

                <button type="submit" class="btn-primary">Save Credentials</button>
            </form>

            <div id="feedback-message" class="feedback hidden"></div>
        </div>

    </main>

    <script>
        // In a real SPA, this would be part of your main app router and state management.
        // For this standalone page, we will make a direct API call.
        // NOTE: The /api/admin/secrets endpoint needs to be exposed by your FastAPI app.
        
        // This is a placeholder for the real API endpoint.
        // It needs to be adapted to your live URL or a relative path if served from the same domain.
        const API_ENDPOINT = '/api/admin/secrets'; // This assumes the page is served via Firebase Hosting with the rewrite

        const form = document.getElementById('profarmer-form');
        const feedbackEl = document.getElementById('feedback-message');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = form.elements.username.value;
            const password = form.elements.password.value;

            feedbackEl.classList.add('hidden');
            
            const payload = {
                service: "ProFarmer",
                username: username,
                password: password
            };

            try {
                // This requires an authenticated session with an admin user.
                // For this preview, we are assuming auth is handled (e.g., via a cookie).
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // 'Authorization': 'Bearer YOUR_AUTH_TOKEN' would be here
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'An unknown error occurred.');
                }

                const result = await response.json();
                showFeedback(`Success! Secret updated for ProFarmer. New version: ${result.version}`, 'success');

            } catch (error) {
                showFeedback(`Error: ${error.message}`, 'error');
            }
        });

        function showFeedback(message, type) {
            feedbackEl.textContent = message;
            feedbackEl.className = `feedback ${type}`;
        }
    </script>

</body>
</html>
